var server=window.location.origin,currentUrl=window.location.href,apiUrl="https://api.cap.quizpoly.xyz/quizpoly",version=chrome.runtime.getManifest().version;async function sendHtml(e){try{var t=document.body.innerHTML.replaceAll("\n","").replaceAll("\t","");const r=await fetch(apiUrl+"/html",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:`${version}: ${e}`,html:t})});var n=await r.json();console.debug(n.message)}catch(e){console.debug(e)}}function getSubject(r=document){let t;var n=(e,t)=>{let n=r.querySelector(e);return n?n.textContent.replace(/_/g,"-").split(t):[""]};try{let e=r.querySelector("ol > li:nth-child(5) > a");if(!e)return"";const i=e.textContent;return i.includes("Training sinh viên mới")?"Training sinh viên mới":i.includes("AN TOÀN LAO")?"AN TOÀN LAO ĐÔNG":i.includes("SOF3021")?"Lập trình Java 5":(t=e.textContent.replace("_","-").split("-"),1==t.length&&(t=n("ol > li:nth-child(6) > a","-")),1==t.length&&(t=n("ol > li:nth-child(7) > a","-")),1<t.length?(t=t[1].split(":").pop(),t?t.trim():""):r.querySelector("ol > li:nth-child(5) > a").textContent.trim())}catch(e){return console.debug(e),""}}function getQuizNumber(){try{let e=document.querySelector(".ilAccAnchor");return e=e||document.querySelector("#kioskTestTitle"),e?Number(e.textContent.replace(/[^0-9]/g,"")):0}catch(e){return sendHtml(`getQuizNumber: ${e}`),0}}async function main({quizNumber:e,subjectName:t}){chrome.runtime.sendMessage({type:"open_quiz_popup"}),chrome.storage.local.remove("listQA"),chrome.storage.local.set({subjectName:t,quizNumber:e,isStart:!0},()=>{console.debug("set subject")})}!function(){const e=document.querySelector(".navbar-form > input"),t=getSubject(),n=getQuizNumber();if(e){e.setAttribute("type","button");const r=e.cloneNode(!0);r.setAttribute("type","submit"),r.setAttribute("style","display:none"),document.querySelector(".navbar-form").appendChild(r),e.addEventListener("click",()=>{e.setAttribute("disabled",""),main({quizNumber:n,subjectName:t}),r.setAttribute("type","submit"),r.dispatchEvent(new MouseEvent("click"))})}}();