const apiUrl="https://api.quizpoly.xyz";let open=window.XMLHttpRequest.prototype.open,send=window.XMLHttpRequest.prototype.send;const trimAns=e=>e.trim().replace(/\s+correct+$/g,"").replace(/ \n\r/g,"\n").replace(/\n\r/g,"\n");function openReplacement(e,t,n,r,o){return this._url=t,open.apply(this,arguments)}function sendReplacement(e){return this.onreadystatechange&&(this._onreadystatechange=this.onreadystatechange),this.onreadystatechange=onReadyStateChangeReplacement,send.apply(this,arguments)}function onReadyStateChangeReplacement(){if(4==this.readyState&&this.responseURL.includes("problem_check")&&submit(JSON.parse(this.response)),this._onreadystatechange)return this._onreadystatechange.apply(this,arguments)}function parseHTML(e){return(new DOMParser).parseFromString(e,"text/html")}async function addQuiz(e){try{var t=document.querySelector(".course-name").innerText.split(" - ")[0];const r=await fetch(apiUrl+"/cms",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subjectName:t,quizzes:e}),credentials:"include"});var n=await r.json();console.debug(n.message)}catch(e){console.log(e)}}function submit(e){if(e.contents){const t=parseHTML(e.contents),n=Array.from(t.querySelectorAll("div.poly")),r=Array.from(t.querySelectorAll("div.wrapper-problem-response"));if(n.length!==r.length)throw new Error("quesel and ansel not compare");qaEle=n.map((e,t)=>[e,r[t]]),addQuiz(qaEle.map(([e,t])=>{const n=e.querySelector(".poly-body");var r=n.querySelector("img"),o=n.querySelector("audio"),e=n.querySelector("a"),o=`${n.textContent.trim()}${r?`\n${r.outerHTML}`:""}${o?`\n${o.outerHTML}`:""}${e?`\n${e.outerHTML}`:""}`.replace(/ \n\r/g,"\n").replace(/\n\r/g,"\n");let a="";e=t.querySelectorAll("input[checked=true]");if(!t.querySelector(".correct"))return{q:null,a:null};if(e&&e.length)a=1<e.length?Array.from(e).map(e=>trimAns(e.parentNode.innerText)):trimAns(e[0].parentNode.innerText);else{const s=t.querySelector("div.correct > input");s&&(a=s.getAttribute("value"))}return{q:o,a:a}}).filter(e=>e.q&&e.a))}}document.addEventListener("DOMContentLoad",()=>{}),window.XMLHttpRequest.prototype.open=openReplacement,window.XMLHttpRequest.prototype.send=sendReplacement;